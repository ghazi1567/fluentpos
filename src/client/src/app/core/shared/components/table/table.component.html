<mat-card class="module-card" style="margin-bottom: 0px !important; padding-bottom: 4px !important">
    <mat-card-header *ngIf="title">
        <mat-card-title>
            {{ title | translate }}
        </mat-card-title>
        <mat-card-subtitle>{{ subtitle | translate }}</mat-card-subtitle>
    </mat-card-header>
    <div style="margin: 0 26px 0 16px">
        <div class="left">
            <span *ngIf="isDisplayButton('Register', null)">
                <a *appHasRights="{ module: moduleName, action: 'Register' }" mat-raised-button color="primary" (click)="openCreateForm()">
                    <mat-icon>add</mat-icon> {{ "components.table.register" | translate }}
                    {{ title }}
                </a>
            </span>
            <a *ngIf="onReload.observers.length > 0" mat-raised-button color="accent" (click)="handleReload()"> <mat-icon>refresh</mat-icon> {{ "components.table.reload" | translate }} </a>
            <a *ngIf="onImport.observers.length > 0" mat-raised-button color="warn" (click)="handleImport()"> <mat-icon>cloud_upload</mat-icon> Import </a>
            <a *ngIf="onExport.observers.length > 0" mat-raised-button color="primary" (click)="handleExport()"> <mat-icon>cloud_download</mat-icon> Export </a>
        </div>
        <div *ngIf="customActionData" class="right">
            <a mat-raised-button color="{{ customActionData.color }}" (click)="handleCustomAction()">
                <mat-icon>{{ customActionData.icon }}</mat-icon>
                {{ customActionData.title }}
            </a>
        </div>
        <div *ngIf="onFilter.observers.length > 0 && !advanceFilters" class="right">
            <mat-form-field>
                <input
                    matInput
                    [(ngModel)]="searchString"
                    name="searchString"
                    type="text"
                    autocomplete="off"
                    (keyup)="handleFilter()"
                    placeholder="{{ 'components.table.filter' | translate }} {{ title | translate }}"
                />
            </mat-form-field>
        </div>
        <div *ngIf="advanceFilters" class="right">
            <a mat-raised-button color="primary" (click)="openAdvanceFilter()">
                <mat-icon>{{ searchIcon }}</mat-icon>
            </a>
        </div>
    </div>
    <!-- Table -->
    <table fixedLayout="false" mat-table mat-table-stripped [dataSource]="tableDataSource" matSort (matSortChange)="handleSort($event)">
        <ng-container *ngFor="let tableColumn of columns" [matColumnDef]="tableColumn.name">
            <!-- if showable column header -->
            <ng-container *ngIf="tableColumn.isShowable || tableColumn.dataKey == 'action'; else notShowable">
                <!-- if sortable column header -->
                <ng-container *ngIf="tableColumn.isSortable; else notSortable">
                    <th mat-header-cell *matHeaderCellDef [mat-sort-header]="tableColumn.name" [arrowPosition]="tableColumn.position === 'right' ? 'before' : 'after'">
                        <ng-container *ngIf="tableColumn.dataKey !== 'selected'">{{ tableColumn.name }}</ng-container>
                        <ng-container *ngIf="tableColumn.dataKey === 'selected'">
                            <mat-checkbox (change)="$event ? masterToggle() : null" [checked]="isAllSelected()" [indeterminate]="!isAllSelected()"> </mat-checkbox>
                        </ng-container>
                    </th>
                </ng-container>
                <!-- else not sortable -->
                <ng-template #notSortable>
                    <th mat-header-cell *matHeaderCellDef [class.text-right]="tableColumn.position == 'right'">
                        <ng-container *ngIf="tableColumn.dataKey !== 'selected'">{{ tableColumn.name }}</ng-container>
                        <ng-container *ngIf="tableColumn.dataKey === 'selected'">
                            <mat-checkbox (change)="$event ? masterToggle() : null" [checked]="isAllSelected()" [indeterminate]="!isAllSelected()"> </mat-checkbox>
                        </ng-container>
                    </th>
                </ng-template>
            </ng-container>

            <ng-template #notShowable>
                <th hidden mat-header-cell *matHeaderCellDef></th>
            </ng-template>

            <!-- column data -->
            <!-- if showable column data -->
            <ng-container *ngIf="tableColumn.isShowable || tableColumn.dataKey == 'action'; else notShowableData">
                <td mat-cell *matCellDef="let element" [class.text-right]="tableColumn.position == 'right'" [ngClass]="{ 'text-right': tableColumn.dataKey === 'action' }">
                    <ng-container *ngIf="tableColumn.isShowable && tableColumn.dataKey !== 'selected'">
                        <span *ngIf="tableColumn.dataKey !== 'isAlert' && tableColumn.dataKey !== 'imageUrl'" [ngClass]="tableColumn.isClass == true ? element.className : ''">
                            {{ element | dataPropertyGetter : tableColumn }}
                        </span>

                        <span *ngIf="tableColumn.dataKey === 'tax'"> ({{ element.taxMethod }})</span>
                        <span *ngIf="tableColumn.dataKey === 'isAlert'">{{ element.isAlert ? "&#10060;" : "&#9989;" }} ({{ element.alertQuantity }})</span>
                        <span *ngIf="tableColumn.dataKey === 'imageUrl'">
                            <img _ngcontent-kaq-c317="" style="border-radius: 20px; max-width: 100%; max-height: 100%" src="{{ element.imageUrl }}" />
                        </span>
                    </ng-container>

                    <ng-container *ngIf="tableColumn.dataKey === 'selected'">
                        <mat-checkbox (click)="$event.stopPropagation()" (change)="element.selected = !element.selected" [checked]="element.selected"> </mat-checkbox>
                    </ng-container>
                    <ng-container *ngIf="tableColumn.dataKey === 'action'" sticky>
                        <span *ngFor="let button of customActionButtons">
                            <button
                                mat-raised-button
                                matTooltip="{{ button.title }}"
                                color="{{ button.color }}"
                                *appHasRights="{ module: moduleName, action: button.rights }"
                                (click)="openCustomActionButton(element, button)"
                            >
                                <mat-icon>{{ button.icon }}</mat-icon>
                            </button>
                        </span>
                        <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu" type="button">
                            <mat-icon>more_vert</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu">
                            <span *ngIf="isDisplayButton('View', element)">
                                <button mat-menu-item *appHasRights="{ module: moduleName, action: 'View' }" (click)="openViewForm(element)">
                                    <mat-icon>remove_red_eye</mat-icon>
                                    <span>View</span>
                                </button>
                            </span>
                            <span *ngIf="isDisplayButton('Update', element)">
                                <button mat-menu-item *appHasRights="{ module: moduleName, action: 'Update' }" color="accent" (click)="openEditForm(element)">
                                    <mat-icon>mode_edit</mat-icon>
                                    <span>Edit</span>
                                </button>
                            </span>
                            <span *ngIf="isDisplayButton('Remove', element)">
                                <button mat-menu-item *appHasRights="{ module: moduleName, action: 'Remove' }" color="danger" (click)="openDeleteConfirmationDialog(element.id)">
                                    <mat-icon>delete</mat-icon>
                                    <span>Delete</span>
                                </button>
                            </span>
                            <span *ngFor="let button of customActionButtons">
                                <span *ngIf="isDisplayButton(button.key, element)">
                                    <button mat-menu-item (click)="openCustomActionButton(element, button)">
                                        <mat-icon>{{ button.icon }}</mat-icon>
                                        <span>{{ button.title }}</span>
                                    </button>
                                </span>
                            </span>
                            <span *ngIf="customActionOneData">
                                <button mat-menu-item (click)="openCustomActionOne(element)">
                                    <mat-icon>{{ customActionOneData.icon }}</mat-icon>
                                    <span>{{ customActionOneData.title }}</span>
                                </button>
                            </span>
                        </mat-menu>
                    </ng-container>
                </td>
            </ng-container>

            <ng-template #notShowableData>
                <th hidden mat-cell *matCellDef="let element"></th>
            </ng-template>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
    <!-- Pagination -->
    <mat-paginator *ngIf="totalCount > 0" [length]="totalCount" [pageSize]="pageSize" [pageSizeOptions]="[5, 10, 25, 100]" (page)="onPageChange($event)" showFirstLastButtons> </mat-paginator>
</mat-card>
